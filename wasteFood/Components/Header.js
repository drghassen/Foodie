import React, { useState, useContext } from 'react';
import { View, Image, TouchableOpacity, StyleSheet, Animated, Text, } from 'react-native';
import { Ionicons } from '@expo/vector-icons';
import { useNavigation } from '@react-navigation/native';
import { ProfileContext } from '../Components/ProfileScreens/ProfileContext';
import { SvgXml } from 'react-native-svg';
import NotificationModal from './NotificationModal';

const svgIcon = `<svg width="235" height="80" viewBox="0 0 235 80" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M35.4303 53.432C34.1076 53.432 32.8489 53.048 31.6543 52.28C30.4596 51.5547 29.5636 50.424 28.9663 48.888C28.7529 48.3333 28.6036 47.736 28.5182 47.096C28.4756 46.456 28.4543 45.8373 28.4543 45.24V44.408C28.4543 44.1093 28.4756 43.832 28.5182 43.576C28.6036 43.32 28.7743 43.192 29.0303 43.192C29.1156 43.192 29.1583 43.2347 29.1583 43.32C29.1583 43.576 29.1369 43.832 29.0943 44.088C29.0943 44.344 29.0943 44.6 29.0943 44.856C29.0943 46.8613 29.5849 48.3973 30.5663 49.464C31.5903 50.488 32.8489 51 34.3423 51C35.8356 51 37.2863 50.5733 38.6943 49.72C40.1023 48.824 41.4036 47.7147 42.5983 46.392C43.2809 45.6667 44.0489 44.5787 44.9023 43.128C45.7983 41.6347 46.7156 39.9707 47.6543 38.136C48.6356 36.2587 49.6169 34.3387 50.5983 32.376C51.5796 30.3707 52.5183 28.4507 53.4143 26.616C54.3103 24.7387 55.1209 23.096 55.8463 21.688C56.5289 20.3653 57.4463 19.32 58.5983 18.552C59.7503 17.784 60.7316 17.2507 61.5423 16.952C61.2436 16.952 60.6036 16.9733 59.6223 17.016C58.6836 17.0587 57.6809 17.1013 56.6143 17.144C55.5476 17.1867 54.6943 17.2293 54.0543 17.272C52.4329 17.3573 50.7903 17.5493 49.1263 17.848C47.4623 18.1467 45.9903 18.552 44.7103 19.064C43.4303 19.576 42.5129 20.2373 41.9583 21.048C41.5743 21.6027 41.3823 22.2427 41.3823 22.968C41.3823 24.4187 42.0223 25.464 43.3022 26.104C43.3876 26.1893 43.4303 26.232 43.4303 26.232C43.4303 26.36 43.3236 26.488 43.1103 26.616C42.8969 26.7013 42.6836 26.7227 42.4703 26.68C42.1289 26.4667 41.7023 26.1253 41.1903 25.656C40.7209 25.144 40.2729 24.6107 39.8463 24.056C39.4623 23.5013 39.2063 23.032 39.0783 22.648C38.8649 22.008 38.7583 21.496 38.7583 21.112C38.7583 20.088 39.1423 19.256 39.9103 18.616C40.6783 17.9333 41.6809 17.4213 42.9183 17.08C44.1556 16.696 45.4783 16.44 46.8863 16.312C48.2943 16.1413 49.6596 16.0347 50.9823 15.992C52.3049 15.9493 53.4356 15.928 54.3743 15.928C56.5503 15.928 58.4916 15.928 60.1982 15.928C61.9476 15.8853 63.5476 15.864 64.9983 15.864C66.4916 15.864 67.9209 15.8853 69.2863 15.928C70.6943 15.9707 72.1663 16.0347 73.7023 16.12C74.8116 16.1627 75.5583 16.376 75.9423 16.76C76.3689 17.144 76.5823 17.6133 76.5823 18.168C76.5823 18.8933 76.3476 19.6827 75.8783 20.536C75.4089 21.3893 74.9823 22.1787 74.5983 22.904C74.4276 23.2453 74.1503 23.5013 73.7663 23.672C73.3823 23.8 73.2329 23.672 73.3183 23.288C73.4036 22.904 73.4889 22.4987 73.5743 22.072C73.6596 21.6027 73.7023 21.1547 73.7023 20.728C73.7023 19.96 73.5529 19.2773 73.2543 18.68C72.9556 18.04 72.4436 17.592 71.7183 17.336C71.2916 17.1653 70.7796 17.0587 70.1823 17.016C69.5849 16.9307 68.9449 16.888 68.2623 16.888C66.9823 16.888 65.7023 17.016 64.4223 17.272C63.1423 17.528 62.1396 17.9333 61.4143 18.488C60.5183 19.1707 59.6009 20.28 58.6623 21.816C57.7663 23.352 56.9129 24.9947 56.1023 26.744C55.2916 28.4933 54.5663 30.0293 53.9263 31.352C53.8836 31.4373 53.8623 31.5653 53.8623 31.736C53.8623 31.9493 54.0543 32.056 54.4383 32.056C55.0356 32.056 55.8676 32.056 56.9343 32.056C58.0436 32.056 59.1956 32.0773 60.3903 32.12C61.5849 32.12 62.6089 32.12 63.4623 32.12C64.4009 32.12 65.1476 32.184 65.7023 32.312C66.2569 32.3973 66.5343 32.6747 66.5343 33.144C66.5343 33.3147 66.4276 33.656 66.2143 34.168C65.9156 34.8507 65.5743 35.448 65.1903 35.96C64.8489 36.4293 64.5716 36.92 64.3583 37.432C64.3156 37.6027 64.1236 37.752 63.7823 37.88C63.4409 38.008 63.3129 37.9867 63.3983 37.816C63.5689 37.432 63.7396 36.9627 63.9103 36.408C64.1236 35.8107 64.2303 35.2987 64.2303 34.872C64.2303 34.1893 63.9316 33.848 63.3343 33.848H53.3503C52.9663 33.848 52.6676 34.0187 52.4543 34.36C51.2169 36.8347 49.8729 39.48 48.4223 42.296C47.0143 45.112 45.3716 47.5227 43.4943 49.528C42.4276 50.68 41.1903 51.6187 39.7823 52.344C38.3743 53.0693 36.9236 53.432 35.4303 53.432ZM79.6563 51.128C78.9736 51.128 78.3549 51 77.8003 50.744C77.2883 50.4453 77.0323 49.8267 77.0323 48.888C77.0323 47.3947 77.4163 45.9013 78.1843 44.408C78.9523 42.872 79.7416 41.528 80.5523 40.376C81.2776 39.3947 82.0883 38.4773 82.9843 37.624C83.9229 36.728 84.9256 35.96 85.9923 35.32C86.6749 34.8933 87.5923 34.4453 88.7443 33.976C89.9389 33.464 90.9416 33.208 91.7523 33.208C92.4349 33.208 93.0323 33.4 93.5443 33.784C94.0563 34.1253 94.3123 34.7653 94.3123 35.704C94.3123 37.1547 93.9283 38.648 93.1603 40.184C92.4349 41.6773 91.6669 43 90.8563 44.152C90.4723 44.664 90.0883 45.1547 89.7043 45.624C89.3203 46.0507 88.8936 46.4987 88.4243 46.968C90.0029 46.968 91.4536 46.52 92.7763 45.624C94.0989 44.6853 95.2509 43.5547 96.2323 42.232L96.3603 42.104C96.4883 42.104 96.5523 42.232 96.5523 42.488C96.5523 42.7867 96.4669 43.064 96.2963 43.32C95.4429 44.5147 94.3763 45.5813 93.0963 46.52C91.8163 47.416 90.3656 47.864 88.7443 47.864C88.5736 47.864 88.4029 47.864 88.2323 47.864C88.0616 47.864 87.8909 47.8427 87.7203 47.8C85.3309 50.0187 82.6429 51.128 79.6563 51.128ZM81.3203 50.04C81.9176 50.04 82.5576 49.8267 83.2403 49.4C83.9656 48.9733 84.5203 48.568 84.9043 48.184C85.6296 47.4587 86.2909 46.6907 86.8883 45.88C87.4856 45.0267 88.0403 44.1733 88.5523 43.32C89.1496 42.296 89.7469 41.08 90.3443 39.672C90.9416 38.264 91.2403 36.9413 91.2403 35.704C91.2403 34.7227 90.8989 34.232 90.2163 34.232C89.6616 34.232 88.9789 34.4667 88.1683 34.936C87.4003 35.4053 86.8243 35.832 86.4403 36.216C84.9896 37.7093 83.7736 39.3307 82.7923 41.08C82.2376 42.0613 81.6403 43.2133 81.0003 44.536C80.3603 45.8587 80.0403 47.0747 80.0403 48.184C80.0403 48.3547 80.0403 48.5253 80.0403 48.696C80.0829 48.824 80.1256 48.9733 80.1683 49.144C80.3389 49.7413 80.7229 50.04 81.3203 50.04ZM109.394 51.128C108.711 51.128 108.092 51 107.538 50.744C107.026 50.4453 106.77 49.8267 106.77 48.888C106.77 47.3947 107.154 45.9013 107.922 44.408C108.69 42.872 109.479 41.528 110.29 40.376C111.015 39.3947 111.826 38.4773 112.722 37.624C113.66 36.728 114.663 35.96 115.73 35.32C116.412 34.8933 117.33 34.4453 118.482 33.976C119.676 33.464 120.679 33.208 121.49 33.208C122.172 33.208 122.77 33.4 123.282 33.784C123.794 34.1253 124.05 34.7653 124.05 35.704C124.05 37.1547 123.666 38.648 122.898 40.184C122.172 41.6773 121.404 43 120.594 44.152C120.21 44.664 119.826 45.1547 119.442 45.624C119.058 46.0507 118.631 46.4987 118.162 46.968C119.74 46.968 121.191 46.52 122.514 45.624C123.836 44.6853 124.988 43.5547 125.97 42.232L126.098 42.104C126.226 42.104 126.29 42.232 126.29 42.488C126.29 42.7867 126.204 43.064 126.034 43.32C125.18 44.5147 124.114 45.5813 122.834 46.52C121.554 47.416 120.103 47.864 118.482 47.864C118.311 47.864 118.14 47.864 117.97 47.864C117.799 47.864 117.628 47.8427 117.458 47.8C115.068 50.0187 112.38 51.128 109.394 51.128ZM111.058 50.04C111.655 50.04 112.295 49.8267 112.978 49.4C113.703 48.9733 114.258 48.568 114.642 48.184C115.367 47.4587 116.028 46.6907 116.626 45.88C117.223 45.0267 117.778 44.1733 118.29 43.32C118.887 42.296 119.484 41.08 120.082 39.672C120.679 38.264 120.978 36.9413 120.978 35.704C120.978 34.7227 120.636 34.232 119.954 34.232C119.399 34.232 118.716 34.4667 117.906 34.936C117.138 35.4053 116.562 35.832 116.178 36.216C114.727 37.7093 113.511 39.3307 112.53 41.08C111.975 42.0613 111.378 43.2133 110.738 44.536C110.098 45.8587 109.778 47.0747 109.778 48.184C109.778 48.3547 109.778 48.5253 109.778 48.696C109.82 48.824 109.863 48.9733 109.906 49.144C110.076 49.7413 110.46 50.04 111.058 50.04ZM146.811 51.192C146.385 51.192 146.022 51.1067 145.723 50.936C145.425 50.7653 145.275 50.4453 145.275 49.976C145.275 49.3787 145.425 48.696 145.723 47.928C146.022 47.16 146.363 46.4133 146.747 45.688C147.131 44.92 147.473 44.3013 147.771 43.832C146.278 45.4107 144.721 46.904 143.099 48.312C142.289 48.9947 141.393 49.6347 140.411 50.232C139.43 50.8293 138.385 51.128 137.275 51.128C136.849 51.128 136.55 51 136.379 50.744C136.209 50.4453 136.123 50.104 136.123 49.72C136.123 49.5067 136.145 49.3573 136.187 49.272C136.401 47.608 136.934 45.88 137.787 44.088C138.641 42.296 139.686 40.6107 140.923 39.032C142.161 37.4533 143.419 36.1733 144.699 35.192C145.681 34.4667 146.619 34.0187 147.515 33.848C148.411 33.6347 149.393 33.528 150.459 33.528H152.571C153.254 32.376 153.958 31.096 154.683 29.688C155.451 28.2373 156.198 26.808 156.923 25.4C157.691 23.992 158.395 22.7547 159.035 21.688C160.785 18.7013 162.705 16.312 164.795 14.52C166.929 12.728 169.297 11.832 171.899 11.832C172.454 11.832 172.966 12.0027 173.435 12.344C173.905 12.6427 174.118 13.112 174.075 13.752L173.947 16.056C173.947 16.0987 173.905 16.1627 173.819 16.248C173.734 16.2907 173.67 16.312 173.627 16.312C173.585 16.312 173.521 16.2693 173.435 16.184C173.307 15.416 172.923 14.84 172.283 14.456C171.643 14.0293 170.854 13.816 169.915 13.816C169.617 13.816 169.275 13.8373 168.891 13.88C168.55 13.9227 168.209 14.008 167.867 14.136C166.673 14.5627 165.542 15.4373 164.475 16.76C163.409 18.04 162.257 19.7467 161.019 21.88C160.593 22.6907 160.038 23.7573 159.355 25.08C158.673 26.36 157.947 27.7467 157.179 29.24C156.454 30.7333 155.75 32.184 155.067 33.592C154.427 35 153.873 36.1947 153.403 37.176C153.19 37.688 152.827 38.4773 152.315 39.544C151.803 40.568 151.249 41.6987 150.651 42.936C150.097 44.1307 149.606 45.24 149.179 46.264C148.795 47.288 148.603 48.0133 148.603 48.44C148.603 49.0373 148.859 49.336 149.371 49.336C149.883 49.336 150.566 49.0373 151.419 48.44C152.273 47.8 153.147 47.032 154.043 46.136C154.982 45.1973 155.814 44.3013 156.539 43.448C157.307 42.5947 157.841 41.9547 158.139 41.528C158.267 41.656 158.331 41.8053 158.331 41.976C158.331 42.2747 158.203 42.5733 157.947 42.872C157.734 43.1707 157.542 43.4267 157.371 43.64C156.603 44.664 155.643 45.7733 154.491 46.968C153.382 48.12 152.166 49.1227 150.843 49.976C149.521 50.7867 148.177 51.192 146.811 51.192ZM139.899 48.952C140.411 48.952 141.115 48.5893 142.011 47.864C142.95 47.096 143.953 46.1573 145.019 45.048C146.086 43.896 147.089 42.7013 148.027 41.464C148.966 40.184 149.734 39.032 150.331 38.008C150.971 36.9413 151.291 36.1307 151.291 35.576C151.291 35.1067 151.142 34.7867 150.843 34.616C150.587 34.4453 150.246 34.36 149.819 34.36C149.137 34.36 148.39 34.616 147.579 35.128C146.811 35.5973 146.193 36.0667 145.723 36.536C145.211 37.0053 144.593 37.752 143.867 38.776C143.185 39.7573 142.502 40.8453 141.819 42.04C141.137 43.2347 140.561 44.3867 140.091 45.496C139.622 46.6053 139.387 47.5013 139.387 48.184C139.387 48.696 139.558 48.952 139.899 48.952ZM183.032 26.552C182.434 26.552 182.008 26.36 181.752 25.976C181.581 25.7627 181.496 25.4853 181.496 25.144C181.496 24.4613 181.816 23.9067 182.456 23.48C182.925 23.224 183.352 23.096 183.736 23.096C184.376 23.096 184.824 23.288 185.08 23.672C185.25 23.8853 185.336 24.1627 185.336 24.504C185.336 25.1867 184.994 25.7413 184.312 26.168C183.928 26.424 183.501 26.552 183.032 26.552ZM171.896 51.192C171.469 51.192 171.106 51.1067 170.808 50.936C170.552 50.7653 170.424 50.4453 170.424 49.976C170.424 49.3787 170.573 48.6747 170.872 47.864C171.213 47.0533 171.576 46.2427 171.96 45.432C172.386 44.6213 172.706 43.96 172.92 43.448C173.218 42.8507 173.581 42.0827 174.008 41.144C174.477 40.1627 174.904 39.2453 175.288 38.392C175.714 37.496 176.013 36.8773 176.184 36.536C175.586 37.176 174.861 37.9867 174.008 38.968C173.197 39.9067 172.429 40.824 171.704 41.72C170.978 42.616 170.424 43.32 170.04 43.832C169.912 44.0027 169.805 44.088 169.72 44.088C169.634 44.088 169.592 43.9813 169.592 43.768C169.592 43.4267 169.698 43.1067 169.912 42.808C170.722 41.784 171.618 40.632 172.6 39.352C173.624 38.072 174.541 36.8987 175.352 35.832C176.162 34.7227 176.674 33.9973 176.888 33.656C177.357 33.5707 178.04 33.4427 178.936 33.272C179.874 33.1013 180.514 32.8667 180.856 32.568C180.984 32.44 181.112 32.376 181.24 32.376C181.325 32.376 181.368 32.4613 181.368 32.632C181.41 32.76 181.368 32.9093 181.24 33.08C180.984 33.3787 180.536 34.104 179.896 35.256C179.256 36.408 178.573 37.688 177.848 39.096C177.165 40.4613 176.525 41.6987 175.928 42.808C175.33 43.96 174.818 45.0693 174.392 46.136C173.965 47.2027 173.752 47.9707 173.752 48.44C173.752 49.0373 174.05 49.336 174.648 49.336C175.202 49.336 175.906 48.9947 176.76 48.312C177.656 47.6293 178.552 46.8187 179.448 45.88C180.344 44.8987 181.133 44.0027 181.816 43.192C182.029 42.936 182.285 42.6373 182.584 42.296C182.925 41.912 183.138 41.6773 183.224 41.592C183.309 41.6773 183.352 41.8267 183.352 42.04C183.309 42.3387 183.202 42.6373 183.032 42.936C182.861 43.192 182.69 43.4267 182.52 43.64C181.624 44.7493 180.642 45.9013 179.576 47.096C178.509 48.248 177.336 49.2293 176.056 50.04C174.776 50.808 173.389 51.192 171.896 51.192ZM198.48 51.512C196.731 51.512 195.515 51.1707 194.832 50.488C194.15 49.8053 193.808 48.9733 193.808 47.992C193.808 46.7547 194.128 45.432 194.768 44.024C195.451 42.616 196.091 41.4213 196.688 40.44C197.371 39.416 198.288 38.3493 199.44 37.24C200.592 36.1307 201.851 35.192 203.216 34.424C204.582 33.656 205.904 33.272 207.184 33.272C208.294 33.272 209.062 33.5493 209.488 34.104C209.915 34.616 210.128 35.2347 210.128 35.96C210.128 37.2827 209.723 38.3707 208.912 39.224C208.144 40.0773 207.184 40.7813 206.032 41.336C204.88 41.848 203.771 42.2747 202.704 42.616C202.064 42.7867 201.318 42.9573 200.464 43.128C199.611 43.2987 198.8 43.384 198.032 43.384C197.734 44.152 197.499 44.8987 197.328 45.624C197.158 46.3493 197.072 47.0107 197.072 47.608C197.072 48.3333 197.243 48.9307 197.584 49.4C197.968 49.8693 198.587 50.104 199.44 50.104C199.782 50.104 200.187 50.0613 200.656 49.976C201.126 49.8907 201.638 49.7627 202.192 49.592C203.472 49.1653 204.731 48.4827 205.968 47.544C207.206 46.6053 208.336 45.6027 209.36 44.536C210.427 43.4267 211.238 42.5093 211.792 41.784C211.92 41.912 211.984 42.0613 211.984 42.232C211.984 42.4453 211.835 42.7867 211.536 43.256C210.683 44.4507 209.574 45.688 208.208 46.968C206.843 48.248 205.328 49.336 203.664 50.232C202 51.0853 200.272 51.512 198.48 51.512ZM198.544 42.104C199.099 42.1467 199.718 42.1467 200.4 42.104C201.126 42.0187 201.83 41.8693 202.512 41.656C204.262 41.144 205.52 40.3333 206.288 39.224C207.099 38.072 207.504 37.048 207.504 36.152C207.504 35.64 207.398 35.2133 207.184 34.872C206.971 34.5307 206.63 34.36 206.16 34.36C204.923 34.36 203.814 34.8293 202.832 35.768C201.851 36.664 200.998 37.7093 200.272 38.904C199.547 40.0987 198.971 41.1653 198.544 42.104Z" fill="#9F8383"/>
</svg>

`;

const COLORS = {
    primary: '#ADA991', // Vert professionnel
    background: '#F8F9FA', // Fond clair et neutre
    text: '#333333', // Texte sombre
    accent: '#FF5252', // Rouge pour les indicateurs
    border: '#E0E0E0', // Bordure légère
    unreadBackground: '#FFFFFF', // Fond des notifications non lues
    readBackground: '#F8F9FA', // Fond des notifications lues
    gradientStart: '#FFFFFF', // Début du dégradé
    gradientEnd: '#F8F9FA', // Fin du dégradé
    darkText: '#1A1A1A', // Texte foncé
    lightText: '#666666', // Texte secondaire
};

const SIZES = {
    headerHeight: 60,
    iconSize: 24,
    profileImageSize: 36,
    badgeSize: 18,
};

const Header = () => {
    const [isModalVisible, setModalVisible] = useState(false);
    const fadeAnim = useState(new Animated.Value(0))[0];
    const navigation = useNavigation();
    const { profilePicture } = useContext(ProfileContext);

    const openNotificationPopup = () => {
        setModalVisible(true);
        Animated.timing(fadeAnim, {
            toValue: 1,
            duration: 300,
            useNativeDriver: true,
        }).start();
    };

    const notifications = [
        { id: 1, message: 'New recipe added: Caesar Salad', isRead: false, time: '2 hours ago', icon: 'restaurant', action: 'View Recipe' },
        { id: 2, message: 'Your order has been shipped', isRead: false, time: '1 day ago', icon: 'local-shipping', action: 'Track Order' },
        { id: 3, message: 'Special promotion: 20% off desserts', isRead: true, time: '3 days ago', icon: 'local-offer', action: 'View Offer' },
    ];

    const closeNotificationPopup = () => {
        Animated.timing(fadeAnim, {
            toValue: 0,
            duration: 300,
            useNativeDriver: true,
        }).start(() => setModalVisible(false));
    };

    return (
        <View>
            <View style={styles.header}>
                <SvgXml xml={svgIcon} width={120} height={90} />
                <View style={styles.iconsContainer}>
                    <TouchableOpacity
                        style={styles.iconWrapper}
                        onPress={openNotificationPopup}
                        activeOpacity={0.7}
                    >
                        <Ionicons name="notifications-outline" size={SIZES.iconSize} color={COLORS.primary} />
                        <View style={styles.badge}>
                            <Text style={styles.badgeText}>3</Text>
                        </View>
                    </TouchableOpacity>
                    <TouchableOpacity
                        style={styles.profileIconWrapper}
                        onPress={() => navigation.navigate('Profile')}
                        activeOpacity={0.7}
                    >
                        <Image
                            source={profilePicture}
                            style={styles.profileImage}
                        />
                    </TouchableOpacity>
                </View>
            </View>
            <NotificationModal
                isVisible={isModalVisible}
                onClose={closeNotificationPopup}
                notifications={notifications}
                fadeAnim={fadeAnim}
            />
        </View>
    );
};

const styles = StyleSheet.create({
    header: {
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
        backgroundColor: COLORS.background,
        paddingHorizontal: 15,
        borderBottomWidth: 1,
        borderBottomColor: COLORS.border,
        height: SIZES.headerHeight,
    },
    iconsContainer: {
        flexDirection: 'row',
        alignItems: 'center',
    },
    iconWrapper: {
        position: 'relative',
    },
    badge: {
        position: 'absolute',
        top: -6,
        right: -6,
        backgroundColor: COLORS.accent,
        borderRadius: SIZES.badgeSize / 2,
        height: SIZES.badgeSize,
        width: SIZES.badgeSize,
        justifyContent: 'center',
        alignItems: 'center',
    },
    badgeText: {
        color: COLORS.background,
        fontSize: 10,
        fontWeight: 'bold',
    },
    profileIconWrapper: {
        marginLeft: 20,
        borderRadius: SIZES.profileImageSize / 2,
        borderColor: COLORS.border,
        borderWidth: 1,
    },
    profileImage: {
        width: SIZES.profileImageSize,
        height: SIZES.profileImageSize,
        borderRadius: SIZES.profileImageSize / 2,
    },
});

export default Header;